{"version":3,"sources":["/src/load-js.js"],"names":["cache","module","exports","load","items","head","document","getElementsByTagName","documentElement","exec","options","url","id","length","result","characters","charactersLength","i","charAt","Math","floor","random","randomString","debug","Error","cacheId","cacheEntry","console","log","allowExternal","el","script","getElementById","loadJS","warn","getScriptById","querySelector","getScriptByUrl","promise","Promise","resolve","text","selector","element","pending","reject","done","onload","onreadystatechange","readyState","onerror","appendChild","createElement","charset","type","async","src","createScript","Array","all","map","unload","prototype","slice","call","querySelectorAll","forEach","parentNode","removeChild"],"mappings":"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","sourcesContent":["var cache = {};\n\nfunction randomString(length) {\n  var result           = \"\";\n  var characters       = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  var charactersLength = characters.length;\n  for ( var i = 0; i < length; i++ ) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nfunction loadJS(items) {\n  var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n\n  function exec(options) {\n    \n    if (typeof options === \"string\") {\n      options = {\n        url: options,\n        id: randomString(8),\n        debug: false\n      };\n    }\n\n    if (!options.id) {\n      throw new Error(\"load-js: must provide a id for load js\");\n    }\n    \n    var cacheId = options.id;\n    var cacheEntry = cache[cacheId];\n\n    if (cacheEntry) {\n      if (!!options.debug) {\n        console.log(\"load-js: cache hit\", cacheId);\n      }\n      return cacheEntry;\n    }\n    else if (options.allowExternal !== false) {\n      var el = getScriptById(options.id) || getScriptByUrl(options.url);\n\n      if (el) {\n        var promise = Promise.resolve(el);\n\n        if (cacheId) {\n          cache[cacheId] = promise;\n        }\n\n        return promise;\n      }\n    }\n\n    if (!options.url && !options.text) {\n      throw new Error(\"load-js: must provide a url or text to load\");\n    }\n    \n    if(options.selector){\n      element = document.querySelector(options.selector);\n      if(element){\n        head = element;\n      }\n    }\n    var pending = (options.url ? loadScript : runScript)(head, createScript(options));\n\n    if (cacheId && options.cache !== false) {\n      cache[cacheId] = pending;\n    }\n\n    return pending;\n  }\n\n  function runScript(head, script) {\n    head.appendChild(script);\n    return Promise.resolve(script);\n  }\n\n  function loadScript(head, script) {\n    return new Promise(function(resolve, reject) {\n      // Handle Script loading\n      var done = false;\n\n      // Attach handlers for all browsers.\n      //\n      // References:\n      // http://stackoverflow.com/questions/4845762/onload-handler-for-script-tag-in-internet-explorer\n      // http://stevesouders.com/efws/script-onload.php\n      // https://www.html5rocks.com/en/tutorials/speed/script-loading/\n      //\n      script.onload = script.onreadystatechange = function() {\n        if (!done && (!script.readyState || script.readyState === \"loaded\" || script.readyState === \"complete\")) {\n          done = true;\n\n          // Handle memory leak in IE\n          script.onload = script.onreadystatechange = null;\n          resolve(script);\n        }\n      };\n\n      script.onerror = reject;\n\n      head.appendChild(script);\n    });\n  }\n\n  function createScript(options) {\n    var script = document.createElement(\"script\");\n    script.charset = options.charset || \"utf-8\";\n    script.type = options.type || \"text/javascript\";\n    script.async = !!options.async;\n    script.id = options.id || options.url;\n    script.loadJS = \"watermark\";\n\n    if (options.url) {\n      script.src = options.url;\n    }\n\n    if (options.text) {\n      script.text = options.text;\n    }\n\n    return script;\n  }\n\n  function getScriptById(id) {\n    var script = id && document.getElementById(id);\n\n    if (script && script.loadJS !== \"watermark\") {\n      console.warn(\"load-js: duplicate script with id:\", id);\n      return script;\n    }\n  }\n\n  function getScriptByUrl(url) {\n    var script = url && document.querySelector(\"script[src='\" + url + \"']\");\n\n    if (script && script.loadJS !== \"watermark\") {\n      console.warn(\"load-js: duplicate script with url:\", url);\n      return script;\n    }\n  }\n\n  console.log(cache);\n  return items instanceof Array ?\n    Promise.all(items.map(exec)) :\n    exec(items);\n  \n}\n\n\nfunction unLoadJS(items){\n  \n  function exec(options){\n    if (typeof options === \"string\") {\n      options = {\n        id: options,\n      };\n    }\n\n    if ( !options.id ) {\n      throw new Error(\"load-js: must provide a id or array ids to unload\");\n    }\n      // Find all script elements and remove them.\n    Array.prototype.slice\n        .call(document.querySelectorAll(`script[id=\"${options.id}\"]`))\n        .forEach(el => {\n          delete cache[el.id];\n          el.parentNode.removeChild(el);\n        });\n    console.log(cache);\n    return true;\n  }\n\n  \n  return items instanceof Array ?\n      items.map(exec) :\n      exec(items);\n  \n}\n\n//module.exports = createLoadJS();\nmodule.exports.load = loadJS;\nmodule.exports.unload = unLoadJS;\n"]}
{"version":3,"sources":["/src/load-js.js"],"names":["cache","module","exports","load","items","exec","options","head","document","getElementsByTagName","documentElement","url","id","length","result","characters","charactersLength","i","charAt","Math","floor","random","randomString","debug","Error","cacheId","cacheEntry","console","log","allowExternal","el","script","getElementById","loadJS","warn","getScriptById","querySelector","getScriptByUrl","promise","Promise","resolve","text","selector","element","pending","reject","done","onload","onreadystatechange","readyState","onerror","appendChild","createElement","charset","type","async","src","createScript","Array","all","map","unload","prototype","slice","call","querySelectorAll","forEach","parentNode","removeChild"],"mappings":"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","sourcesContent":["var cache = {};\n\nfunction randomString(length) {\n  var result           = \"\";\n  var characters       = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  var charactersLength = characters.length;\n  for ( var i = 0; i < length; i++ ) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nfunction loadJS(items) {\n\n  function exec(options) {\n    var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n    \n    if (typeof options === \"string\") {\n      options = {\n        url: options,\n        id: randomString(8),\n        debug: false\n      };\n    }\n\n    if (!options.id) {\n      throw new Error(\"load-js: must provide a id for load js\");\n    }\n    \n    var cacheId = options.id;\n    var cacheEntry = cache[cacheId];\n\n    if (cacheEntry) {\n      if (!!options.debug) {\n        console.log(\"load-js: cache hit\", cacheId);\n      }\n      return cacheEntry;\n    }\n    else if (options.allowExternal !== false) {\n      var el = getScriptById(options.id) || getScriptByUrl(options.url);\n\n      if (el) {\n        var promise = Promise.resolve(el);\n\n        if (cacheId) {\n          cache[cacheId] = promise;\n        }\n\n        return promise;\n      }\n    }\n\n    if (!options.url && !options.text) {\n      throw new Error(\"load-js: must provide a url or text to load\");\n    }\n    \n    if(options.selector){\n      element = document.querySelector(options.selector);\n      if(element){\n        head = element;\n      }\n    }\n    var pending = (options.url ? loadScript : runScript)(head, createScript(options));\n\n    if (cacheId && options.cache !== false) {\n      cache[cacheId] = pending;\n    }\n\n    return pending;\n  }\n\n  function runScript(head, script) {\n    head.appendChild(script);\n    return Promise.resolve(script);\n  }\n\n  function loadScript(head, script) {\n    return new Promise(function(resolve, reject) {\n      // Handle Script loading\n      var done = false;\n\n      // Attach handlers for all browsers.\n      //\n      // References:\n      // http://stackoverflow.com/questions/4845762/onload-handler-for-script-tag-in-internet-explorer\n      // http://stevesouders.com/efws/script-onload.php\n      // https://www.html5rocks.com/en/tutorials/speed/script-loading/\n      //\n      script.onload = script.onreadystatechange = function() {\n        if (!done && (!script.readyState || script.readyState === \"loaded\" || script.readyState === \"complete\")) {\n          done = true;\n\n          // Handle memory leak in IE\n          script.onload = script.onreadystatechange = null;\n          resolve(script);\n        }\n      };\n\n      script.onerror = reject;\n\n      head.appendChild(script);\n    });\n  }\n\n  function createScript(options) {\n    var script = document.createElement(\"script\");\n    script.charset = options.charset || \"utf-8\";\n    script.type = options.type || \"text/javascript\";\n    script.async = !!options.async;\n    script.id = options.id || options.url;\n    script.loadJS = \"watermark\";\n\n    if (options.url) {\n      script.src = options.url;\n    }\n\n    if (options.text) {\n      script.text = options.text;\n    }\n\n    return script;\n  }\n\n  function getScriptById(id) {\n    var script = id && document.getElementById(id);\n\n    if (script && script.loadJS !== \"watermark\") {\n      console.warn(\"load-js: duplicate script with id:\", id);\n      return script;\n    }\n  }\n\n  function getScriptByUrl(url) {\n    var script = url && document.querySelector(\"script[src='\" + url + \"']\");\n\n    if (script && script.loadJS !== \"watermark\") {\n      console.warn(\"load-js: duplicate script with url:\", url);\n      return script;\n    }\n  }\n  \n  return items instanceof Array ?\n    Promise.all(items.map(exec)) :\n    exec(items);\n  \n}\n\n\nfunction unLoadJS(items){\n  \n  function exec(options){\n    if (typeof options === \"string\") {\n      options = {\n        id: options,\n      };\n    }\n\n    if ( !options.id ) {\n      throw new Error(\"load-js: must provide a id or array ids to unload\");\n    }\n      // Find all script elements and remove them.\n    Array.prototype.slice\n        .call(document.querySelectorAll(`script[id=\"${options.id}\"]`))\n        .forEach(el => {\n          delete cache[el.id];\n          el.parentNode.removeChild(el);\n        });\n    return true;\n  }\n\n  \n  return items instanceof Array ?\n      items.map(exec) :\n      exec(items);\n  \n}\n\n//module.exports = createLoadJS();\nmodule.exports.load = loadJS;\nmodule.exports.unload = unLoadJS;\n"]}
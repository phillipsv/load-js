{"version":3,"sources":["/src/load-js.js"],"names":["cache","module","exports","load","items","exec","options","head","document","getElementsByTagName","documentElement","url","id","length","result","characters","charactersLength","i","charAt","Math","floor","random","randomString","debug","Error","cacheId","cacheEntry","console","log","allowExternal","el","script","getElementById","loadJS","warn","getScriptById","querySelector","getScriptByUrl","promise","Promise","resolve","text","selector","element","pending","reject","done","onload","onreadystatechange","readyState","onerror","appendChild","createElement","charset","type","async","src","createScript","Array","all","map","unload","response","prototype","slice","call","querySelectorAll","forEach","parentNode","removeChild","push","removed"],"mappings":"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","sourcesContent":["var cache = {};\n\nfunction randomString(length) {\n    var result = \"\";\n    var characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    var charactersLength = characters.length;\n    for (var i = 0; i < length; i++) {\n        result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n    return result;\n}\n\nfunction loadJS(items) {\n\n    function exec(options) {\n        var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n\n        if (typeof options === \"string\") {\n            options = {\n                url: options,\n                id: randomString(8),\n                debug: false\n            };\n        }\n\n        if (!options.id) {\n            throw new Error(\"load-js: must provide a id for load js\");\n        }\n\n        var cacheId = options.id;\n        var cacheEntry = cache[cacheId];\n\n        if (cacheEntry) {\n            if (!!options.debug) {\n                console.log(\"load-js: cache hit\", cacheId);\n            }\n            return cacheEntry;\n        } else if (options.allowExternal !== false) {\n            var el = getScriptById(options.id) || getScriptByUrl(options.url);\n\n            if (el) {\n                var promise = Promise.resolve(el);\n\n                if (cacheId) {\n                    cache[cacheId] = promise;\n                }\n\n                return promise;\n            }\n        }\n\n        if (!options.url && !options.text) {\n            throw new Error(\"load-js: must provide a url or text to load\");\n        }\n\n        if (options.selector) {\n            element = document.querySelector(options.selector);\n            if (element) {\n                head = element;\n            }\n        }\n        var pending = (options.url ? loadScript : runScript)(head, createScript(options));\n\n        if (cacheId && options.cache !== false) {\n            cache[cacheId] = pending;\n        }\n\n        return pending;\n    }\n\n    function runScript(head, script) {\n        head.appendChild(script);\n        return Promise.resolve(script);\n    }\n\n    function loadScript(head, script) {\n        return new Promise(function (resolve, reject) {\n            // Handle Script loading\n            var done = false;\n\n            // Attach handlers for all browsers.\n            //\n            // References:\n            // http://stackoverflow.com/questions/4845762/onload-handler-for-script-tag-in-internet-explorer\n            // http://stevesouders.com/efws/script-onload.php\n            // https://www.html5rocks.com/en/tutorials/speed/script-loading/\n            //\n            script.onload = script.onreadystatechange = function () {\n                if (!done && (!script.readyState || script.readyState === \"loaded\" || script.readyState === \"complete\")) {\n                    done = true;\n\n                    // Handle memory leak in IE\n                    script.onload = script.onreadystatechange = null;\n                    resolve(script);\n                }\n            };\n\n            script.onerror = reject;\n\n            head.appendChild(script);\n        });\n    }\n\n    function createScript(options) {\n        var script = document.createElement(\"script\");\n        script.charset = options.charset || \"utf-8\";\n        script.type = options.type || \"text/javascript\";\n        script.async = !!options.async;\n        script.id = options.id || options.url;\n        script.loadJS = \"watermark\";\n\n        if (options.url) {\n            script.src = options.url;\n        }\n\n        if (options.text) {\n            script.text = options.text;\n        }\n\n        return script;\n    }\n\n    function getScriptById(id) {\n        var script = id && document.getElementById(id);\n\n        if (script && script.loadJS !== \"watermark\") {\n            console.warn(\"load-js: duplicate script with id:\", id);\n            return script;\n        }\n    }\n\n    function getScriptByUrl(url) {\n        var script = url && document.querySelector(\"script[src='\" + url + \"']\");\n\n        if (script && script.loadJS !== \"watermark\") {\n            console.warn(\"load-js: duplicate script with url:\", url);\n            return script;\n        }\n    }\n\n    return items instanceof Array ?\n        Promise.all(items.map(exec)) :\n        exec(items);\n\n}\n\n\nfunction unLoadJS(items) {\n\n    function exec(options) {\n        if (typeof options === \"string\") {\n            options = {\n                id: options,\n            };\n        }\n\n        if (!options.id) {\n            throw new Error(\"load-js: must provide a id or array ids to unload\");\n        }\n        \n        let response = {};\n        // Find all script elements and remove them.\n        Array.prototype.slice\n            .call(document.querySelectorAll(`script[id=\"${options.id}\"]`))\n            .forEach(el => {\n                delete cache[el.id];\n                el.parentNode.removeChild(el);\n                response.push({id: options.id, removed: true});\n            });\n\n        return response;\n    }\n\n\n    return items instanceof Array ?\n        items.map(exec) :\n        exec(items);\n\n}\n\n//module.exports = createLoadJS();\nmodule.exports.load = loadJS;\nmodule.exports.unload = unLoadJS;\n"]}